<div class="intro intro--loading">
  <div class="layout">
    <div class="intro__content">
      <h1 class="intro__heading">
        <a id="top">{{ .Page.Params.h1 }}</a>
      </h1>
      <div id="introText" class="intro__text">{{ .Inner }}</div>
      <div class="share">
        <a class="share__link share__link--twitter">
          <i class="fa fa-twitter"></i>
          <span>Share on Twitter</span>
        </a>
        <a class="share__link share__link--facebook">
          <i class="fa fa-facebook"></i>
          <span>Share on Facebook</span>
        </a>
      </div>
    </div>
    <div class="intro__figure">
      <div class="intro__loading">
        <div class="spinner">
          <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>
      <div id="introChart" class="intro__figure-wrapper">
        <h2 class="intro__figure-title">Eviction Filings By Week</h2>
        <svg role="img" aria-label="Chart of eviction filings by week"></svg>
        <div class="intro__figure-legend legend">
          <div class="legend-item">
            <svg
              class="legend-item__visual"
              role="img"
              aria-labelledby="filingsBarLegend"
              width="16"
              height="16"
              viewBox="0 0 16 16"
            >
              <title id="filingsBarLegend">
                Grey rectangle legend indicator
              </title>
              <rect x="0" y="0" width="16" height="16"></rect>
            </svg>
            <p class="legend-item__label">Weekly Filings</p>
          </div>
          <div class="legend-item">
            <svg
              class="legend-item__visual"
              aria-labelledby="trendLegend"
              role="img"
              width="16"
              height="16"
              viewBox="0 0 16 16"
            >
              <title id="trendLegend">Red line legend indicator</title>
              <path d="M 0,8 h 16" fill="none"></path>
            </svg>
            <p class="legend-item__label">Filings Trend</p>
          </div>
          <div class="legend-item">
            <svg
              class="legend-item__visual"
              role="img"
              aria-labelledby="patternLegend"
              width="16"
              height="16"
              viewBox="0 0 16 16"
            >
              <title id="patternLegend">Striped pattern legend indicator</title>
              <pattern
                id="stripesLegend"
                x="0"
                y="0"
                width="8"
                height="8"
                patternUnits="userSpaceOnUse"
                patternTransform="rotate(45)"
              >
                <rect
                  class="legend-item__pattern legend-item__pattern--localLegend"
                  x="0"
                  y="0"
                  width="4"
                  height="8"
                ></rect>
              </pattern>
              <rect
                x="0"
                y="0"
                width="16"
                height="16"
                fill="url(#stripesLegend)"
              ></rect>
            </svg>
            <p class="legend-item__label">
              Local Moratorium<span
                class="legend-item__secondary"
                id="evictionMoratorium"
              ></span>
            </p>
          </div>
          <div class="legend-item">
            <svg
              class="legend-item__visual"
              role="img"
              aria-labelledby="patternLegend"
              width="16"
              height="16"
              viewBox="0 0 16 16"
            >
              <title id="patternLegend">Striped pattern legend indicator</title>
              <pattern
                id="cdcLegend"
                x="0"
                y="0"
                width="8"
                height="8"
                patternUnits="userSpaceOnUse"
                patternTransform="rotate(-45)"
              >
                <rect
                  class="legend-item__pattern legend-item__pattern--cdcLegend"
                  x="0"
                  y="0"
                  width="4"
                  height="8"
                ></rect>
              </pattern>
              <rect
                x="0"
                y="0"
                width="16"
                height="16"
                fill="url(#cdcLegend)"
              ></rect>
            </svg>
            <p class="legend-item__label">
              <a href="https://evictionlab.org/federal-eviction-moratorium-update/">CDC Order</a>
              <span
                class="legend-item__secondary"
                id="cdcGuidelines"></span>
            </p>
          </div>
        </div>
        <div class="intro__figure-stats">
          <p id="filingsLastWeek"></p>
          <p id="filingsCumulative"></p>
        </div>
        <p class="intro__figure-footnote">
          * Filings in the last week may be undercounted as a result of
          processing delays. These counts will be revised in the following week.
        </p>
      </div>
    </div>
  </div>

  <script>
    var tableUrl = {{ .Get "data" }}
    var fips = {{ .Get "id" }}
    var rentersSite = {{ .Get "rentersSite" }}
    window.addEventListener('load', function() {
      Elab.Utils.createTwitterLink('.share__link--twitter')
      Elab.Utils.createFacebookLink('.share__link--facebook')
      var dateFormat = d3.timeFormat("%b %e, %Y")
      var cdcMoratorium = Elab.Utils.getCdcMoratoriumRange().map(function(d) {
        return dateFormat(d)
      }).join(' - ')
      $('#cdcGuidelines').text(cdcMoratorium)
      Elab.Intro.initIntroChart(document.getElementById("introChart"), tableUrl, fips)
      Elab.Data.loadData(
        "/uploads/renter_hhs_by_state.csv",
        function(d) { return d },
        function(r) {
          var rentersData = r.find(row => row.site === rentersSite)
          if (rentersData) {
            $('.intro__heading')
            .after(`<h3 class="intro__renter-population">RENTER POPULATION: 
              ${Number(rentersData.estimate).toLocaleString()}</h3>`)
          }
        })
      Elab.Data.loadData(
        "/uploads/renter_hhs_by_city.csv",
        function(d) { return d },
        function(r) {
          var rentersData = r.find(row => row.site === rentersSite)
          if (rentersData) {
            $('.intro__heading')
            .after(`<h3 class="intro__renter-population">RENTER POPULATION: 
              ${Number(rentersData.estimate).toLocaleString()}</h3>`)
          }
        })
    })
  </script>
</div>
