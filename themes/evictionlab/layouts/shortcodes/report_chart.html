{{ if eq (.Get `id`) "avg" }}
{{ $.Scratch.Set "ariaLabel" "Bar chart showing average filings and filing counts by month" }}
{{ end }}
{{ if eq (.Get `id`) "race" }}
{{ $.Scratch.Set "ariaLabel" "Bar chart showing average filings and filing counts by month grouped by neighborhood demographics" }}
{{ end }}
{{ $imputedNoteNumber := .Get `imputedNoteNumber` }}
<section
  id="{{ .Get `id` }}"
  class="section section--chart section--{{ .Get `id` }}"
>
  <div class="section__content">
    <div class="details">{{ .Inner }}</div>
    <div class="visual">
      <div class="visual__header">
        <h3 class="visual__title"></h3>
      </div>
      <svg class="chart" role="img" aria-label="{{ $.Scratch.Get `ariaLabel` }}"></svg>
      <div class="visual__toggle">
        <div class="button-group">
          <button class="toggle toggle--count">
            Filing Counts
          </button>
          <button class="toggle toggle--avg">
            Vs. Average
          </button>
        </div>
        <div class="button-group time-span"></div>
      </div>
    </div>
    <div class="legend"></div>
    <p class="footnote">
      <span class="data-download"><a href="{{ .Get `data` }}">Get the data</a> for this figure</span>
    </p>
    </div>
    <div class="section__content imputed-data-only">
      <div class="details">
        <p><strong>Eviction filings by defendant race/ethnicity and gender</strong></p>
        <p>
        There are often large
        <a href="https://evictionlab.org/demographics-of-eviction/">
          racial/ethnic and gender disparities in eviction risk</a>.
        Here, we estimate the demographic characteristics of those filed against for eviction over
        the last year. We compare to data from the ACS that show the share of renters in the same
        categories.<sup>1</sup>
        </p>
      </div>
      <div class="visual">
        <div class="visual__header">
          <h3 class="visual__title">FILINGS OVER THE LAST YEAR BY DEFENDANT RACE/ETHNICITY AND GENDER
          </h3>
        </div>
        <div class="comparison-block-wrapper" id="imputedComps--{{ .Get `id` }}">
        <div class="comparison-legend">
          <div><span class="color-chip chip-a"></span>
            <p class="caption">Share of eviction filings</p>
          </div>
          <div><span class="color-chip chip-b"></span>
            <p class="caption">Share of renters</p>
          </div>
        </div>
        </div>
    </div>
    <div class="additional-footnote">
      <ul>
        <li>
          Statistics rely on imputation of race/ethnicity and gender based on defendant names and addresses. A complete
          description of this process can be found in the <a href="https://evictionlab.org/eviction-tracking/methods/">ETS
            methods
            page</a>.
        </li>
      </ul>
      <br />
      <span class="data-download"><a href="{{ .Get `data` }}">Get the data</a> for these figures</span>
    </div>
  </div>
  <script>
    window.addEventListener('load', function() {
      var id = {{ .Get "id" }}
      var csv = {{ .Get "data" }}
      var rootEl = '#'+id
      var comparisonFiles = [
        { id: "imputed", url: csv },
      ]
      var comparisons = [
        {
          file: 'imputed',
          fieldA: 'month_filings_imputed',
          fieldB: 'baseline_share',
          display: 'Black',
          group: 'Black',
          formatter: d3.format('.0%'),
        },
        {
          file: 'imputed',
          fieldA: 'month_filings_imputed',
          fieldB: 'baseline_share',
          display: 'Latinx',
          group: 'Latinx',
          formatter: d3.format('.0%'),
        },
        {
          file: 'imputed',
          fieldA: 'month_filings_imputed',
          fieldB: 'baseline_share',
          display: 'White',
          group: 'White',
          formatter: d3.format('.0%'),
        },
        {
          file: 'imputed',
          fieldA: 'month_filings_imputed',
          fieldB: 'baseline_share',
          display: 'Female',
          group: 'Female',
          formatter: d3.format('.0%'),
        },
      ]
      var getVals = (fileData, s) => {
        var row = fileData.findLast((d) => d.group === s.group);
        return row ? [row[s.fieldA], row[s.fieldB]] : [];
      }
      var callback = (dataFound) => {
        if (dataFound) {
          $('#race .section__content.imputed-data-only').css("display", "block");
          $("#race .footnote .data-download").css("display", "none");
        } 
      }
      if (id === "race") {
        Elab.Utils.createComparisonBlock('#imputedComps--race', comparisonFiles, comparisons, getVals, callback)
    }
      Elab.Section.init('chart', rootEl, { id: id, csv: csv })
    });
  </script>
</section>
