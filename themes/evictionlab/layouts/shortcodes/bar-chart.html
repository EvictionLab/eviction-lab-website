{{/**

  This shortcode is for adding a grouped bar chart to markdown.

  Parameters for the shortcode are as follows:

  id: id to be assigned to chart element
  title: first half of the chart title (when search is enabled an input is placed in between)
  data: path to data csv, ex: "/uploads/county_prop_lookup.csv"
  yTicks: number of ticks for y-axis
  yFormat: d3 format, ex: ".0%"
  xTicks: semicolon-delineated list of ticks for x-axis (bar groups), ex: "Asian;Black;Latinx;White"
  columns: columns to pass from csv to chart, ex:  "cofips,state,county,year_string,renters_prop_a,defendant_prop_a,judgment_prop_a,renters_prop_b,defendant_prop_b,judgment_prop_b,"
  xBars: comma- and semicolon-delineated array of arrays indicating how column values are grouped on bars in bar groups, ex: "renters_prop_a,defendant_prop_a,judgment_prop_a;renters_prop_b,defendant_prop_b,judgment_prop_b;renters_prop_l,defendant_prop_l,judgment_prop_l;renters_prop_w,defendant_prop_w,judgment_prop_w" highlight: semicolon-delineated list of bar types (in each group), ex: "renters;defendant;judgment"
  active: ID of active item in data, ex: "0"
  type: type of chart, ex: "barGroup"
  legendItems: semicolon-delineated list of legend labels, same count as xTicks, ex: "Share of renters;Share of defendants;Share of judgments"
*/}}


{{ $title := .Get "title" }}
{{ $legend := .Get "highlight" }}
{{ $legendItems := split (.Get "legendItems") ";" }}


<div
  class="bar-chart bar-chart--banded bar-chart--{{ .Get `id` }}"
>
  {{ if $title }}
  <h3 class="bar-chart__title">{{ $title }}</h3>
  {{ end }}
  <div id="{{ .Get `id` }}" class="bar-chart__chart chart">
    <svg></svg>
  </div>
  {{ if $legend }}
  <div class="bar-chart__legend legend">
  {{ range $index, $element := $legendItems }}
  <div class="legend-item legend-item--{{ $index }}">
  <div class="legend-item__color"></div>
  <div class="legend-item__label">{{ $element }}</div>
  </div>
  {{ end }}
  </div>
  {{ end }}
  <script>
    var id = {{ .Get "id" }}
    var csv = {{ .Get "data" }}
    var x = {{ .Get "x" }}
    var y = {{ .Get "y" }}
    var yTicks = {{ .Get "yTicks" }}
    var yMin = {{ .Get "yMin" }}
    var yMax = {{ .Get "yMax" }}
    var yFormat = {{ .Get "yFormat" }}
    var xTicks = {{ .Get "xTicks" }}
    var xFormat = {{ .Get "xFormat" }}
    var highlight = {{ .Get "highlight" }}
    var active = {{ .Get "active" }}
    var rootEl = document.getElementById(id);
    /**
     * Initializes chart with whatever values currently are set to.
     */

    var data = [];
    window.addEventListener('load', function() {
      // Init chart on page load.
      Elab.BasicBarChart.init(rootEl, { data: csv, x: x, y: y, yMin: yMin, yMax: yMax, yTicks: yTicks, yFormat: yFormat, xTicks: xTicks, xFormat: xFormat })
    });
  </script>
</div>
